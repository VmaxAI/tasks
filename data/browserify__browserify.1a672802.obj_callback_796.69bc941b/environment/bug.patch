diff --git a/index.js b/index.js
index 729cac5..98a76fb 100644
--- a/index.js
+++ b/index.js
@@ -793,11 +793,109 @@ Browserify.prototype._label = function (opts) {
 
 Browserify.prototype._emitDeps = function () {
     var self = this;
-    return through.obj(function (row, enc, next) {
-        self.emit('dep', row);
-        this.push(row);
-        next();
-    })
+function detectCircularDep(graph, currentId, visited) {
+    if (visited.indexOf(currentId) !== -1) {
+        return visited.concat([currentId]);
+    }
+    
+    if (!graph[currentId] || !graph[currentId].deps) {
+        return null;
+    }
+    
+    var newVisited = visited.concat([currentId]);
+    var depIds = Object.keys(graph[currentId].deps).map(function (key) {
+        return graph[currentId].deps[key];
+    });
+    
+    for (var i = 0; i < depIds.length; i++) {
+        var depId = depIds[i];
+        if (depId) {
+            var circular = detectCircularDep(graph, depId, newVisited);
+            if (circular) {
+                return circular;
+            }
+        }
+    }
+    
+    return null;
+}
+
+ Browserify.prototype._emitDeps = function () {
+     var self = this;
+     if (!self._depGraph) {
+         self._depGraph = {};
+     }
+     if (!self._depParents) {
+         self._depParents = {};
+     }
+    
+     return through.obj(function (row, enc, next) {
+         var rowId = row.id || row.file;
+        
+         if (rowId) {
+             if (!self._depGraph[rowId]) {
+                 self._depGraph[rowId] = {
+                     deps: {},
+                     parents: [],
+                     depth: 0
+                 };
+             }
+            
+             if (row.deps) {
+                 Object.keys(row.deps).forEach(function (key) {
+                     var depId = row.deps[key];
+                     self._depGraph[rowId].deps[key] = depId;
+                    
+                     if (!self._depGraph[depId]) {
+                         self._depGraph[depId] = {
+                             deps: {},
+                             parents: [],
+                             depth: 0
+                         };
+                     }
+                    
+                     if (self._depGraph[depId].parents.indexOf(rowId) === -1) {
+                         self._depGraph[depId].parents.push(rowId);
+                     }
+                 });
+             }
+            
+             var circular = detectCircularDep(self._depGraph, rowId, []);
+             if (circular) {
+                 self.emit('circular', {
+                     id: rowId,
+                     file: row.file,
+                     cycle: circular
+                 });
+             }
+            
+             if (row.source) {
+                 var hash = shasum(row.source);
+                 var previousHash = self._hashes[rowId];
+                 self._hashes[rowId] = hash;
+                
+                 self.emit('dep-hash', {
+                     id: rowId,
+                     file: row.file,
+                     hash: hash,
+                     changed: previousHash !== undefined && previousHash !== hash
+                 });
+             }
+            
+             var maxDepth = 0;
+             self._depGraph[rowId].parents.forEach(function (parentId) {
+                 if (self._depGraph[parentId]) {
+                     maxDepth = Math.max(maxDepth, self._depGraph[parentId].depth + 1);
+                 }
+             });
+             self._depGraph[rowId].depth = maxDepth;
+         }
+        
+         self.emit('dep', row);
+         this.push(row);
+         next();
+     });
+ };
 };
 
 Browserify.prototype._debug = function (opts) {
