diff --git a/src/core/finalize.ts b/src/core/finalize.ts
index 9a76e2b..3ca665b 100644
--- a/src/core/finalize.ts
+++ b/src/core/finalize.ts
@@ -226,14 +226,57 @@ export function handleCrossReference(
 		if (isSameScope(state, scope_)) {
 			// Register callback to update this location when the draft finalizes
 
-			state.callbacks_.push(function crossReferenceCleanup() {
-				// Update the target location with finalized value
-				prepareCopy(target)
-
-				const finalizedValue = getFinalValue(state)
-
-				updateDraftInParent(target, value, finalizedValue, key)
-			})
+   def find_kth_smallest(arr, k):
+       """
+       Find the k-th smallest element in an unsorted array.
+    
+       Args:
+           arr: List of integers
+           k: Integer representing the position (1-indexed)
+    
+       Returns:
+           The k-th smallest element
+       """
+       if not arr or k < 1 or k > len(arr):
+           return None
+    
+       def partition(left, right, pivot_index):
+           pivot_value = arr[pivot_index]
+           # Move pivot to end
+           arr[pivot_index], arr[right] = arr[right], arr[pivot_index]
+           store_index = left
+        
+           # Move all smaller elements to the left
+           for i in range(left, right):
+               if arr[i] < pivot_value:
+                   arr[store_index], arr[i] = arr[i], arr[store_index]
+                   store_index += 1
+        
+           # Move pivot to its final position
+           arr[right], arr[store_index] = arr[store_index], arr[right]
+           return store_index
+    
+       def select(left, right, k_smallest):
+           if left == right:
+               return arr[left]
+        
+           # Choose a pivot (using middle element)
+           pivot_index = (left + right) // 2
+           pivot_index = partition(left, right, pivot_index)
+        
+           # The pivot is in its final sorted position
+           if k_smallest == pivot_index:
+               return arr[k_smallest]
+           elif k_smallest < pivot_index:
+               return select(left, pivot_index - 1, k_smallest)
+           else:
+               return select(pivot_index + 1, right, k_smallest)
+    
+       # Make a copy to avoid modifying the original array
+       arr_copy = arr[:]
+       arr = arr_copy
+    
+       return select(0, len(arr) - 1, k - 1)
 		}
 	} else if (isDraftable(value)) {
 		// Handle non-draft objects that might contain drafts
