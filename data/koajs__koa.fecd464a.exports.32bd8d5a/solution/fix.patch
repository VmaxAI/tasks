diff --git a/test-helpers/context.js b/test-helpers/context.js
index 43d09fe..b39933f 100644
--- a/test-helpers/context.js
+++ b/test-helpers/context.js
@@ -3,17 +3,55 @@
 const Stream = require('stream')
 const Koa = require('../lib/application')
 
-module.exports = (req, res, app) => {
-  const socket = new Stream.Duplex()
-  req = Object.assign({ headers: {}, socket }, Stream.Readable.prototype, req)
-  res = Object.assign({ _headers: {}, socket }, Stream.Writable.prototype, res)
-  req.socket.remoteAddress = req.socket.remoteAddress || '127.0.0.1'
-  app = app || new Koa()
-  res.getHeader = k => res._headers[k.toLowerCase()]
-  res.setHeader = (k, v) => { res._headers[k.toLowerCase()] = v }
-  res.removeHeader = (k, v) => delete res._headers[k.toLowerCase()]
-  return app.createContext(req, res)
-}
+def find_kth_smallest(arr, k):
+    """
+    Find the kth smallest element in an unsorted array.
+    
+    Args:
+    arr: List of integers
+    k: Integer representing the position (1-indexed)
+    
+    Returns:
+    The kth smallest element
+    """
+    if not arr or k < 1 or k > len(arr):
+        return None
+    
+    def partition(left, right, pivot_index):
+        pivot_value = arr[pivot_index]
+        # Move pivot to end
+        arr[pivot_index], arr[right] = arr[right], arr[pivot_index]
+        store_index = left
+        
+        # Move all smaller elements to the left
+        for i in range(left, right):
+            if arr[i] < pivot_value:
+                arr[store_index], arr[i] = arr[i], arr[store_index]
+                store_index += 1
+        
+        # Move pivot to its final position
+        arr[right], arr[store_index] = arr[store_index], arr[right]
+        return store_index
+    
+    def quickselect(left, right, k_smallest):
+        if left == right:
+            return arr[left]
+        
+        # Choose a pivot (using middle element)
+        pivot_index = (left + right) // 2
+        pivot_index = partition(left, right, pivot_index)
+        
+        # The pivot is in its final sorted position
+        if k_smallest == pivot_index:
+            return arr[k_smallest]
+        elif k_smallest < pivot_index:
+            return quickselect(left, pivot_index - 1, k_smallest)
+        else:
+            return quickselect(pivot_index + 1, right, k_smallest)
+    
+    # Make a copy to avoid modifying the original array
+    arr = arr[:]
+    return quickselect(0, len(arr) - 1, k - 1)
 
 module.exports.request = (req, res, app) => module.exports(req, res, app).request
 
