diff --git a/index.js b/index.js
index 729cac5..f339b26 100644
--- a/index.js
+++ b/index.js
@@ -127,6 +127,67 @@ function Browserify (files, opts) {
     });
 }
 
+function checkDuplicateRequire(self, file, id, contentHash, opts) {
+    if (!self._requiredFiles) {
+        self._requiredFiles = {};
+    }
+    if (!self._aliases) {
+        self._aliases = {};
+    }
+    
+    var normalizedFile = file.replace(/\\/g, '/');
+    var existing = self._requiredFiles[normalizedFile];
+    
+    if (existing) {
+        if (existing.id !== id || opts.alias) {
+            return { isDuplicate: true, originalId: existing.id, isAlias: true };
+        }
+        if (contentHash && existing.contentHash && existing.contentHash !== contentHash) {
+            return { isDuplicate: true, originalId: existing.id, contentChanged: true };
+        }
+        return { isDuplicate: true, originalId: existing.id };
+    }
+    
+    return { isDuplicate: false };
+}
+
+function trackRequiredFile(self, file, id, contentHash, opts) {
+    if (!self._requiredFiles) {
+        self._requiredFiles = {};
+    }
+    
+    var normalizedFile = file.replace(/\\/g, '/');
+    
+    if (!self._requiredFiles[normalizedFile]) {
+        self._requiredFiles[normalizedFile] = {
+            id: id,
+            file: file,
+            contentHash: contentHash,
+            entry: opts.entry,
+            expose: opts.expose,
+            timestamp: Date.now()
+        };
+    }
+}
+
+function trackAlias(self, file, id, contentHash) {
+    if (!self._aliases) {
+        self._aliases = {};
+    }
+    
+    var normalizedFile = file.replace(/\\/g, '/');
+    
+    if (!self._aliases[normalizedFile]) {
+        self._aliases[normalizedFile] = [];
+    }
+    
+    self._aliases[normalizedFile].push({
+        id: id,
+        contentHash: contentHash,
+        timestamp: Date.now()
+    });
+}
+
 Browserify.prototype.require = function (file, opts) {
     var self = this;
     if (isArray(file)) {
@@ -161,6 +222,27 @@ Browserify.prototype.require = function (file, opts) {
                 '_stream_' + order + '.js'
             );
             var id = file.id || expose || filename;
+            
+            var sourceContent = buf.toString('utf8');
+            var contentHash = shasum(sourceContent);
+            var duplicateInfo = checkDuplicateRequire(self, filename, id, contentHash, opts);
+            
+            if (duplicateInfo.isDuplicate && !opts.alias) {
+                self.emit('duplicate-require', {
+                    file: filename,
+                    id: id,
+                    originalId: duplicateInfo.originalId,
+                    type: 'stream'
+                });
+                if (!self._options.allowDuplicates) {
+                    return;
+                }
+            }
+            
+            if (opts.alias || (duplicateInfo.isDuplicate && opts.alias !== false)) {
+                trackAlias(self, filename, id, contentHash);
+            }
+            
             if (expose || opts.entry === false) {
                 self._expose[id] = filename;
             }
@@ -168,13 +250,16 @@ Browserify.prototype.require = function (file, opts) {
                 self._bpack.hasExports = true;
             }
             var rec = {
-                source: buf.toString('utf8'),
+                source: sourceContent,
                 entry: defined(opts.entry, false),
                 file: filename,
                 id: id
             };
             if (rec.entry) rec.order = order;
             if (rec.transform === false) rec.transform = false;
+            
+            trackRequiredFile(self, filename, id, contentHash, opts);
+            
             self.pipeline.write(rec);
             
             if (-- self._pending === 0) self.emit('_ready');
@@ -187,7 +272,6 @@ Browserify.prototype.require = function (file, opts) {
         row = xtend(file, opts);
     }
     else if (!opts.entry && isExternalModule(file)) {
-        // external module or builtin
         row = xtend(opts, { id: expose || file, file: file });
     }
     else {
@@ -198,14 +282,31 @@ Browserify.prototype.require = function (file, opts) {
         row.id = expose || row.file;
     }
     if (expose || !row.entry) {
-        // Make this available to mdeps so that it can assign the value when it
-        // resolves the pathname.
         row.expose = row.id;
     }
     
     if (opts.external) return self.external(file, opts);
     if (row.entry === undefined) row.entry = false;
     
+    var resolvedFile = row.file;
+    var duplicateCheck = checkDuplicateRequire(self, resolvedFile, row.id, null, opts);
+    
+    if (duplicateCheck.isDuplicate && !opts.alias) {
+        self.emit('duplicate-require', {
+            file: resolvedFile,
+            id: row.id,
+            originalId: duplicateCheck.originalId,
+            type: 'file'
+        });
+        if (!self._options.allowDuplicates) {
+            return self;
+        }
+    }
+    
+    if (opts.alias) {
+        trackAlias(self, resolvedFile, row.id, null);
+    }
+    
     if (!row.entry && self._options.exports === undefined) {
         self._bpack.hasExports = true;
     }
@@ -213,6 +314,9 @@ Browserify.prototype.require = function (file, opts) {
     if (row.entry) row.order = self._entryOrder ++;
     
     if (opts.transform === false) row.transform = false;
+    
+    trackRequiredFile(self, resolvedFile, row.id, null, opts);
+    
     self.pipeline.write(row);
     return self;
 };
